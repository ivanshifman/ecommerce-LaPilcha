{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/lib/auth/auth-middleware.ts"],"sourcesContent":["import { NextRequest } from 'next/server';\nimport { UserRole } from '../../types/auth.types';\n\nexport interface DecodedToken {\n  sub: string;\n  email: string;\n  role: UserRole;\n  iat: number;\n  exp: number;\n}\n\nexport async function getCurrentUser(req: NextRequest): Promise<DecodedToken | null> {\n  const accessToken = req.cookies.get('access_token')?.value;\n  \n  if (!accessToken) {\n    return null;\n  }\n\n  try {\n    const payload = JSON.parse(\n      Buffer.from(accessToken.split('.')[1], 'base64').toString()\n    );\n\n    return {\n      sub: payload.sub,\n      email: payload.email,\n      role: payload.role,\n      iat: payload.iat,\n      exp: payload.exp,\n    };\n  } catch (error) {\n    console.error('Token decode failed:', error);\n    return null;\n  }\n}\n\nexport async function isAuthenticated(req: NextRequest): Promise<boolean> {\n  const user = await getCurrentUser(req);\n  \n  if (!user) return false;\n  \n  const now = Math.floor(Date.now() / 1000);\n  return user.exp > now;\n}\n\nexport async function hasRole(req: NextRequest, allowedRoles: UserRole[]): Promise<boolean> {\n  const user = await getCurrentUser(req);\n  \n  if (!user) return false;\n  \n  return allowedRoles.includes(user.role);\n}"],"names":[],"mappings":";;;;;;;;AAoBM;AATC,eAAe,eAAe,GAAgB;IACnD,MAAM,cAAc,IAAI,OAAO,CAAC,GAAG,CAAC,iBAAiB;IAErD,IAAI,CAAC,aAAa;QAChB,OAAO;IACT;IAEA,IAAI;QACF,MAAM,UAAU,KAAK,KAAK,CACxB,+HAAM,CAAC,IAAI,CAAC,YAAY,KAAK,CAAC,IAAI,CAAC,EAAE,EAAE,UAAU,QAAQ;QAG3D,OAAO;YACL,KAAK,QAAQ,GAAG;YAChB,OAAO,QAAQ,KAAK;YACpB,MAAM,QAAQ,IAAI;YAClB,KAAK,QAAQ,GAAG;YAChB,KAAK,QAAQ,GAAG;QAClB;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO;IACT;AACF;AAEO,eAAe,gBAAgB,GAAgB;IACpD,MAAM,OAAO,MAAM,eAAe;IAElC,IAAI,CAAC,MAAM,OAAO;IAElB,MAAM,MAAM,KAAK,KAAK,CAAC,KAAK,GAAG,KAAK;IACpC,OAAO,KAAK,GAAG,GAAG;AACpB;AAEO,eAAe,QAAQ,GAAgB,EAAE,YAAwB;IACtE,MAAM,OAAO,MAAM,eAAe;IAElC,IAAI,CAAC,MAAM,OAAO;IAElB,OAAO,aAAa,QAAQ,CAAC,KAAK,IAAI;AACxC"}},
    {"offset": {"line": 59, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/types/auth.types.ts"],"sourcesContent":["export enum UserRole {\n  ADMIN = 'admin',\n  CUSTOMER = 'customer',\n}\n\nexport enum AuthProvider {\n  LOCAL = 'local',\n  GOOGLE = 'google',\n  APPLE = 'apple',\n}\n\nexport interface User {\n  id: string;\n  name: string;\n  lastName?: string;\n  email: string;\n  role: UserRole;\n  authProvider: AuthProvider;\n  emailVerified: boolean;\n  avatar?: string;\n  phone?: string;\n  createdAt?: string;\n  updatedAt?: string;\n  createdAtLocal?: string;\n  updatedAtLocal?: string;\n}\n\nexport interface RegisterDto {\n  name: string;\n  lastName?: string;\n  email: string;\n  password: string;\n  phone?: string;\n}\n\nexport interface LoginDto {\n  email: string;\n  password: string;\n}\n\nexport interface VerifyEmailDto {\n  userId: string;\n  code: string;\n}\n\nexport interface ResendVerificationDto {\n  userId: string;\n}\n\nexport interface ForgotPasswordDto {\n  email: string;\n}\n\nexport interface ResetPasswordDto {\n  token: string;\n  newPassword: string;\n}\n\nexport interface ChangePasswordDto {\n  currentPassword: string;\n  newPassword: string;\n}\n\nexport interface UpdateUserDto {\n  name?: string;\n  lastName?: string;\n  phone?: string;\n  avatar?: string;\n  preferences?: {\n    defaultSize?: string;\n    favoriteColors?: string[];\n  };\n}\n\nexport interface AuthResponse {\n  user: User;\n  accessToken: string;\n  refreshToken: string;\n}\n\nexport interface RegisterResponse extends User {\n  message: string;\n}\n\nexport interface ProfileResponse extends User {\n  wishlist: string[];\n  preferences?: {\n    defaultSize?: string;\n    favoriteColors?: string[];\n  };\n  totalOrders: number;\n  totalSpent: number;\n  lastLogin?: string;\n  lastLoginLocal?: string;\n}\n\nexport interface AdminUserResponseDto extends User {\n  isActive: boolean;\n  lastLogin?: Date;\n  totalOrders?: number;\n  totalSpent?: number;\n}"],"names":[],"mappings":";;;;;;AAAO,IAAA,AAAK,kCAAA;;;WAAA;;AAKL,IAAA,AAAK,sCAAA;;;;WAAA"}},
    {"offset": {"line": 80, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/lib/auth/route-protection.ts"],"sourcesContent":["import { UserRole } from \"../../types/auth.types\";\n\n\nexport interface RouteConfig {\n  path: string;\n  requiresAuth: boolean;\n  allowedRoles?: UserRole[];\n  redirectTo?: string;\n}\n\nexport const ROUTE_PROTECTION: RouteConfig[] = [\n  {\n    path: '/',\n    requiresAuth: false,\n  },\n  {\n    path: '/products',\n    requiresAuth: false,\n  },\n  {\n    path: '/about',\n    requiresAuth: false,\n  },\n  {\n    path: '/contact',\n    requiresAuth: false,\n  },\n  {\n    path: '/login',\n    requiresAuth: false,\n    redirectTo: '/',\n  },\n  {\n    path: '/register',\n    requiresAuth: false,\n    redirectTo: '/',\n  },\n  {\n    path: '/forgot-password',\n    requiresAuth: false,\n    redirectTo: '/',\n  },\n  {\n    path: '/reset-password',\n    requiresAuth: false,\n    redirectTo: '/',\n  },\n  {\n    path: '/profile',\n    requiresAuth: true,\n    allowedRoles: [UserRole.CUSTOMER, UserRole.ADMIN],\n  },\n  {\n    path: '/orders',\n    requiresAuth: true,\n    allowedRoles: [UserRole.CUSTOMER, UserRole.ADMIN],\n  },\n  {\n    path: '/checkout',\n    requiresAuth: true,\n    allowedRoles: [UserRole.CUSTOMER, UserRole.ADMIN],\n  },\n  {\n    path: '/wishlist',\n    requiresAuth: true,\n    allowedRoles: [UserRole.CUSTOMER, UserRole.ADMIN],\n  },\n  {\n    path: '/returns',\n    requiresAuth: true,\n    allowedRoles: [UserRole.CUSTOMER, UserRole.ADMIN],\n  },\n  {\n    path: '/admin',\n    requiresAuth: true,\n    allowedRoles: [UserRole.ADMIN],\n  },\n];\n\nexport function getRouteConfig(pathname: string): RouteConfig | undefined {\n  return ROUTE_PROTECTION.find((route) => {\n    if (route.path === pathname) return true;\n    if (pathname.startsWith(route.path + '/')) return true;\n    return false;\n  });\n}\n\nexport function isPublicRoute(pathname: string): boolean {\n  const config = getRouteConfig(pathname);\n  return !config || !config.requiresAuth;\n}\n\nexport function hasAccess(pathname: string, userRole?: UserRole): boolean {\n  const config = getRouteConfig(pathname);\n  \n  if (!config) return true;\n  if (!config.requiresAuth) return true;\n  if (!userRole) return false;\n  if (!config.allowedRoles) return true;\n  \n  return config.allowedRoles.includes(userRole);\n}"],"names":[],"mappings":";;;;;;;;;;AAAA;;AAUO,MAAM,mBAAkC;IAC7C;QACE,MAAM;QACN,cAAc;IAChB;IACA;QACE,MAAM;QACN,cAAc;IAChB;IACA;QACE,MAAM;QACN,cAAc;IAChB;IACA;QACE,MAAM;QACN,cAAc;IAChB;IACA;QACE,MAAM;QACN,cAAc;QACd,YAAY;IACd;IACA;QACE,MAAM;QACN,cAAc;QACd,YAAY;IACd;IACA;QACE,MAAM;QACN,cAAc;QACd,YAAY;IACd;IACA;QACE,MAAM;QACN,cAAc;QACd,YAAY;IACd;IACA;QACE,MAAM;QACN,cAAc;QACd,cAAc;YAAC,iJAAQ,CAAC,QAAQ;YAAE,iJAAQ,CAAC,KAAK;SAAC;IACnD;IACA;QACE,MAAM;QACN,cAAc;QACd,cAAc;YAAC,iJAAQ,CAAC,QAAQ;YAAE,iJAAQ,CAAC,KAAK;SAAC;IACnD;IACA;QACE,MAAM;QACN,cAAc;QACd,cAAc;YAAC,iJAAQ,CAAC,QAAQ;YAAE,iJAAQ,CAAC,KAAK;SAAC;IACnD;IACA;QACE,MAAM;QACN,cAAc;QACd,cAAc;YAAC,iJAAQ,CAAC,QAAQ;YAAE,iJAAQ,CAAC,KAAK;SAAC;IACnD;IACA;QACE,MAAM;QACN,cAAc;QACd,cAAc;YAAC,iJAAQ,CAAC,QAAQ;YAAE,iJAAQ,CAAC,KAAK;SAAC;IACnD;IACA;QACE,MAAM;QACN,cAAc;QACd,cAAc;YAAC,iJAAQ,CAAC,KAAK;SAAC;IAChC;CACD;AAEM,SAAS,eAAe,QAAgB;IAC7C,OAAO,iBAAiB,IAAI,CAAC,CAAC;QAC5B,IAAI,MAAM,IAAI,KAAK,UAAU,OAAO;QACpC,IAAI,SAAS,UAAU,CAAC,MAAM,IAAI,GAAG,MAAM,OAAO;QAClD,OAAO;IACT;AACF;AAEO,SAAS,cAAc,QAAgB;IAC5C,MAAM,SAAS,eAAe;IAC9B,OAAO,CAAC,UAAU,CAAC,OAAO,YAAY;AACxC;AAEO,SAAS,UAAU,QAAgB,EAAE,QAAmB;IAC7D,MAAM,SAAS,eAAe;IAE9B,IAAI,CAAC,QAAQ,OAAO;IACpB,IAAI,CAAC,OAAO,YAAY,EAAE,OAAO;IACjC,IAAI,CAAC,UAAU,OAAO;IACtB,IAAI,CAAC,OAAO,YAAY,EAAE,OAAO;IAEjC,OAAO,OAAO,YAAY,CAAC,QAAQ,CAAC;AACtC"}},
    {"offset": {"line": 200, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/middleware.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport type { NextRequest } from 'next/server';\nimport { getCurrentUser } from './lib/auth/auth-middleware';\nimport { getRouteConfig } from './lib/auth/route-protection';\n\nexport async function middleware(req: NextRequest) {\n  const { pathname } = req.nextUrl;\n\n  if (\n    pathname.startsWith('/api/') ||\n    pathname.startsWith('/_next/') ||\n    pathname.startsWith('/static/') ||\n    pathname.includes('.')\n  ) {\n    return NextResponse.next();\n  }\n\n  const user = await getCurrentUser(req);\n  const isLoggedIn = user !== null;\n\n  const routeConfig = getRouteConfig(pathname);\n\n  if (!routeConfig) {\n    return NextResponse.next();\n  }\n\n  if (isLoggedIn && routeConfig.redirectTo && !routeConfig.requiresAuth) {\n    return NextResponse.redirect(new URL(routeConfig.redirectTo, req.url));\n  }\n\n  if (routeConfig.requiresAuth && !isLoggedIn) {\n    const loginUrl = new URL('/login', req.url);\n    loginUrl.searchParams.set('from', pathname);\n    return NextResponse.redirect(loginUrl);\n  }\n\n  if (\n    routeConfig.requiresAuth &&\n    routeConfig.allowedRoles &&\n    user &&\n    !routeConfig.allowedRoles.includes(user.role)\n  ) {\n    const forbiddenUrl = new URL('/403', req.url);\n    return NextResponse.redirect(forbiddenUrl);\n  }\n\n  return NextResponse.next();\n}\n\n// Configurar qu√© rutas procesa el middleware\nexport const config = {\n  matcher: [\n    /*\n     * Match all request paths except:\n     * - api (API routes)\n     * - _next/static (static files)\n     * - _next/image (image optimization files)\n     * - favicon.ico (favicon file)\n     * - public files (images, etc)\n     */\n    '/((?!api|_next/static|_next/image|favicon.ico|.*\\\\..*|public).*)',\n  ],\n};"],"names":[],"mappings":";;;;;;AAAA;AAAA;AAEA;AACA;;;;AAEO,eAAe,WAAW,GAAgB;IAC/C,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAI,OAAO;IAEhC,IACE,SAAS,UAAU,CAAC,YACpB,SAAS,UAAU,CAAC,cACpB,SAAS,UAAU,CAAC,eACpB,SAAS,QAAQ,CAAC,MAClB;QACA,OAAO,gMAAY,CAAC,IAAI;IAC1B;IAEA,MAAM,OAAO,MAAM,IAAA,kKAAc,EAAC;IAClC,MAAM,aAAa,SAAS;IAE5B,MAAM,cAAc,IAAA,mKAAc,EAAC;IAEnC,IAAI,CAAC,aAAa;QAChB,OAAO,gMAAY,CAAC,IAAI;IAC1B;IAEA,IAAI,cAAc,YAAY,UAAU,IAAI,CAAC,YAAY,YAAY,EAAE;QACrE,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,YAAY,UAAU,EAAE,IAAI,GAAG;IACtE;IAEA,IAAI,YAAY,YAAY,IAAI,CAAC,YAAY;QAC3C,MAAM,WAAW,IAAI,IAAI,UAAU,IAAI,GAAG;QAC1C,SAAS,YAAY,CAAC,GAAG,CAAC,QAAQ;QAClC,OAAO,gMAAY,CAAC,QAAQ,CAAC;IAC/B;IAEA,IACE,YAAY,YAAY,IACxB,YAAY,YAAY,IACxB,QACA,CAAC,YAAY,YAAY,CAAC,QAAQ,CAAC,KAAK,IAAI,GAC5C;QACA,MAAM,eAAe,IAAI,IAAI,QAAQ,IAAI,GAAG;QAC5C,OAAO,gMAAY,CAAC,QAAQ,CAAC;IAC/B;IAEA,OAAO,gMAAY,CAAC,IAAI;AAC1B;AAGO,MAAM,SAAS;IACpB,SAAS;QACP;;;;;;;KAOC,GACD;KACD;AACH"}}]
}